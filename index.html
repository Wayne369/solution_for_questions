<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ethereal Oracle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Noto+Serif+TC:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #08080c;
            --accent-color: #d4af37; /* åƒæ˜¯ç‡™é‡‘çš„è³ªæ„Ÿ */
            --glow-color: rgba(212, 175, 55, 0.4);
            --text-color: #e0e0e0;
            --secondary-text: #888899;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Cormorant Garamond', 'Noto Serif TC', serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
            touch-action: none;
        }

        /* èƒŒæ™¯ï¼šæ·±é‚ƒçš„å¾‘å‘æ¼¸å±¤ */
        body::before {
            content: "";
            position: absolute;
            width: 150%; height: 150%;
            background: radial-gradient(circle at 50% 50%, #1c1c2e 0%, #050508 60%);
            animation: breathe 10s infinite alternate;
            z-index: -2;
        }

        @keyframes breathe {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.05); opacity: 1; }
        }

        /* æ§åˆ¶åˆ— (Home & Mute) */
        .controls {
            position: absolute;
            top: 20px;
            width: 100%;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            z-index: 50;
            pointer-events: none; /* è®“ä¸­é–“ä¸æ“‹ä½æ“ä½œ */
        }

        .ctrl-btn {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 50px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ctrl-btn:hover {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }

        /* æ ¸å¿ƒå€åŸŸ */
        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        /* æ³•é™£ (äº’å‹•æ ¸å¿ƒ) */
        .oracle-core {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* å¤–åœˆè£é£¾ç·š */
        .oracle-core::before {
            content: "";
            position: absolute;
            top: -15px; left: -15px; right: -15px; bottom: -15px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            transform: scale(0.8);
            transition: transform 0.5s;
        }

        .oracle-core:hover::before {
            transform: scale(1);
        }

        /* èƒ½é‡ SVG */
        .progress-ring-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.1s linear;
            stroke: var(--accent-color);
            stroke-width: 2;
            fill: transparent;
            filter: drop-shadow(0 0 8px var(--glow-color));
        }
        
        /* å…§éƒ¨åœ–é¨° */
        .symbol {
            font-size: 2rem;
            opacity: 0.5;
            transition: all 0.3s;
            color: var(--text-color);
        }

        .oracle-core.charging .symbol {
            opacity: 1;
            transform: scale(1.2);
            color: var(--accent-color);
            text-shadow: 0 0 15px var(--accent-color);
        }

        .oracle-core.shake {
            animation: shake-hard 0.1s infinite;
        }

        @keyframes shake-hard {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            100% { transform: translate(-1px, -2px) rotate(-1deg); }
        }

        /* æç¤ºæ–‡å­— */
        .instruction {
            margin-top: 50px;
            font-size: 1rem;
            letter-spacing: 0.2em;
            color: var(--secondary-text);
            text-transform: uppercase;
            font-weight: 300;
            opacity: 0.7;
            transition: opacity 0.5s;
        }

        /* ç­”æ¡ˆé¡¯ç¤ºå€ */
        .answer-display {
            position: absolute;
            top: 20%;
            width: 90%;
            text-align: center;
            pointer-events: none;
            z-index: 20;
        }

        .answer-text {
            font-family: 'Noto Serif TC', serif;
            font-size: 3rem;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .answer-text.show {
            opacity: 1;
            transform: translateY(0);
            text-shadow: 0 0 30px var(--glow-color);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.6s;
        }

        .modal.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .modal h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 5px;
            color: var(--accent-color);
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .start-btn {
            background: transparent;
            border: 1px solid var(--secondary-text);
            color: var(--text-color);
            padding: 12px 40px;
            font-size: 1.1rem;
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

    </style>
</head>
<body>

    <div class="controls">
        <div class="ctrl-btn" onclick="resetApp()">
            <span>â†º</span> é‡ç½®
        </div>
        <div class="ctrl-btn" id="mute-btn" onclick="toggleMute()">
            <span>ğŸ”Š</span>
        </div>
    </div>

    <div class="modal" id="modal">
        <h1>Void Oracle</h1>
        <p style="color: #666; margin-bottom: 40px; letter-spacing: 2px; font-size: 0.9rem;">é–‹å•Ÿè²éŸ³ä»¥ç²å¾—æœ€ä½³é«”é©—</p>
        <button class="start-btn" onclick="initExperience()">é€²å…¥å„€å¼</button>
    </div>

    <div class="container">
        
        <div class="answer-display">
            <div class="answer-text" id="answer"></div>
        </div>

        <div class="oracle-core" id="core">
            <svg width="180" height="180" style="position: absolute; top:0; left:0; pointer-events: none;">
                <circle class="progress-ring-circle" 
                        stroke="white" 
                        stroke-width="1" 
                        fill="transparent" 
                        r="88" 
                        cx="90" 
                        cy="90" 
                        stroke-dasharray="552" 
                        stroke-dashoffset="552" />
            </svg>
            <div class="symbol">âœ¦</div>
        </div>

        <p class="instruction" id="instruction">é•·æŒ‰é€£çµå®‡å®™æ„è­˜</p>
    </div>

    <script>
        // === è³‡æ–™åº« ===
        const answers = [
            "ç„¡éœ€å¤šè¨€", "æ™‚æ©Ÿæœªåˆ°", "è½å¾å…§å¿ƒ", "ä¿æŒéœé»˜",
            "å¤§è†½å‰è¡Œ", "æ”¾ä¸‹åŸ·å¿µ", "çµæœé©šäºº", "ç­‰å¾…ä¿¡è™Ÿ",
            "çµ•éå¶ç„¶", "å°‹æ±‚ç›Ÿå‹", "å›æ­¸åˆå¿ƒ", "ç­”æ¡ˆåœ¨é¢¨ä¸­",
            "ç¨å®‰å‹¿èº", "è¬¹æ…è¡Œäº‹", "å…‰åœ¨å‰æ–¹", "æ··æ²Œæœªæ˜",
            "é€™å€¼å¾—å†’éšª", "é‡æ–°æ€è€ƒ", "ä½ æ˜¯å°çš„", "å‘½é‹å·²å®š"
        ];

        // === éŸ³æ•ˆå¼•æ“ (Web Audio API) ===
        // ä½¿ç”¨ç¨‹å¼ç¢¼ç”ŸæˆéŸ³æ•ˆï¼Œä¸éœ€å¤–éƒ¨æª”æ¡ˆ
        const AudioEngine = {
            ctx: null,
            masterGain: null,
            droneOsc: null,
            isMuted: false,

            init() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.3; // æ•´é«”éŸ³é‡
                this.masterGain.connect(this.ctx.destination);
            },

            toggleMute() {
                this.isMuted = !this.isMuted;
                if (this.masterGain) {
                    this.masterGain.gain.setTargetAtTime(this.isMuted ? 0 : 0.3, this.ctx.currentTime, 0.1);
                }
                return this.isMuted;
            },

            // èƒŒæ™¯ä½é »å—¡å—¡è²
            startDrone() {
                if (!this.ctx) return;
                // å‰µå»ºå…©å€‹æŒ¯ç›ªå™¨ç”¢ç”Ÿæ‹é » (Beats)
                const osc1 = this.ctx.createOscillator();
                const osc2 = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc1.type = 'sine';
                osc2.type = 'triangle';
                osc1.frequency.value = 55; // ä½éŸ³ A
                osc2.frequency.value = 57; // ç¨å¾®èµ°éŸ³ç”¢ç”Ÿæ³¢å‹•æ„Ÿ
                
                gain.gain.value = 0.1;
                
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(this.masterGain);
                
                osc1.start();
                osc2.start();
                this.droneOsc = { osc1, osc2, gain };
            },

            // è“„åŠ›éŸ³æ•ˆ (é »ç‡çˆ¬å‡)
            playCharge(progress) {
                if (!this.ctx || this.isMuted) return;
                // é€™è£¡æˆ‘å€‘ç”¨ä¸€å€‹ç°¡å–®çš„å³æ™‚åˆæˆéŸ³ï¼Œä¸åšå¤ªè¤‡é›œçš„é€£çºŒéŸ³
                // ç‚ºäº†æ•ˆèƒ½ï¼Œæˆ‘å€‘åªåœ¨é—œéµç¯€é»è§¸ç™¼å¾®å¼±çš„é›»æµè²ï¼Œæˆ–è€…ç”¨è¦–è¦ºä»£æ›¿
                // çœŸæ­£çš„ Shepard Tone å¯¦ä½œè¼ƒè¤‡é›œï¼Œé€™è£¡ç”¨ç°¡å–®çš„çŸ­éŸ³é »æ¨¡æ“¬
            },

            // æ­æ›‰éŸ³æ•ˆ (ç©ºéˆé˜è²)
            playReveal() {
                if (!this.ctx || this.isMuted) return;
                const now = this.ctx.currentTime;
                
                // ç”¢ç”Ÿä¸€å€‹å¤§ä¸‰å’Œå¼¦
                const freqs = [440, 554.37, 659.25, 880]; // A4, C#5, E5, A5
                
                freqs.forEach((f, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = f;
                    
                    // åŒ…çµ¡ç·š (Envelope): å¿«é€Ÿæ”»æ“Šï¼Œé•·é‡‹æ”¾
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.1 / (i+1), now + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 3);
                    
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start(now);
                    osc.stop(now + 3.5);
                });
            },

            // å¤±æ•—/å–æ¶ˆéŸ³æ•ˆ
            playCancel() {
                if (!this.ctx || this.isMuted) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(100, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, this.ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.3);
                
                osc.connect(gain);
                gain.connect(this.masterGain);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.3);
            },
            
            // è“„åŠ›æ™‚çš„é›»æµè² (æŒçºŒéŸ³)
            chargeOsc: null,
            chargeGain: null,
            startChargeSound() {
                if (!this.ctx || this.isMuted) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.type = 'sawtooth';
                osc.frequency.value = 50;
                
                // ä½é€šæ¿¾æ³¢å™¨è®“è²éŸ³è®Šæ‚¶
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 400;

                gain.gain.setValueAtTime(0, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.05, this.ctx.currentTime + 1); // æ¼¸å¼·

                osc.connect(filter);
                filter.connect(gain);
                gain.connect(this.masterGain);
                
                osc.start();
                this.chargeOsc = osc;
                this.chargeGain = gain;
            },

            updateChargePitch(percent) {
                if (this.chargeOsc) {
                    // éš¨è‘—é€²åº¦æé«˜é »ç‡
                    const baseFreq = 50;
                    this.chargeOsc.frequency.setTargetAtTime(baseFreq + (percent * 2), this.ctx.currentTime, 0.1);
                }
            },

            stopChargeSound() {
                if (this.chargeOsc) {
                    const now = this.ctx.currentTime;
                    this.chargeGain.gain.linearRampToValueAtTime(0, now + 0.1);
                    this.chargeOsc.stop(now + 0.1);
                    this.chargeOsc = null;
                }
            }
        };

        // === é‚è¼¯æ§åˆ¶ ===
        const core = document.getElementById('core');
        const ring = document.querySelector('.progress-ring-circle');
        const answerEl = document.getElementById('answer');
        const instruction = document.getElementById('instruction');
        const modal = document.getElementById('modal');
        const muteBtn = document.getElementById('mute-btn');

        let charge = 0;
        let isHolding = false;
        let animFrame;
        const totalLength = 552; // åœ“å‘¨é•· 2 * PI * 88
        let isRevealed = false;

        // åˆå§‹åŒ–
        function initExperience() {
            modal.classList.add('hidden');
            AudioEngine.init();
            AudioEngine.startDrone();
        }

        // éœéŸ³åˆ‡æ›
        function toggleMute() {
            const muted = AudioEngine.toggleMute();
            muteBtn.innerHTML = muted ? "<span>ğŸ”‡</span>" : "<span>ğŸ”Š</span>";
            muteBtn.style.opacity = muted ? "0.5" : "1";
        }

        // é‡ç½® APP
        function resetApp() {
            isHolding = false;
            isRevealed = false;
            charge = 0;
            updateRing(0);
            
            answerEl.classList.remove('show');
            setTimeout(() => { answerEl.innerText = ""; }, 500);
            
            instruction.style.opacity = 1;
            instruction.innerText = "é•·æŒ‰é€£çµå®‡å®™æ„è­˜";
            
            core.style.transform = "scale(1)";
            core.classList.remove('shake');
            core.classList.remove('charging');
        }

        // äº’å‹•äº‹ä»¶
        function startHold(e) {
            if (e.cancelable) e.preventDefault();
            if (isRevealed) return;

            isHolding = true;
            core.classList.add('charging');
            instruction.style.opacity = 0.5;
            
            AudioEngine.startChargeSound(); // é–‹å§‹è“„åŠ›éŸ³æ•ˆ
            loop();
        }

        function endHold() {
            isHolding = false;
            core.classList.remove('charging');
            core.classList.remove('shake');
            AudioEngine.stopChargeSound(); // åœæ­¢è“„åŠ›éŸ³æ•ˆ

            if (charge >= 100) {
                reveal();
            } else {
                // å›é€€
                AudioEngine.playCancel(); // æ’­æ”¾å–æ¶ˆéŸ³æ•ˆ
                const rollback = setInterval(() => {
                    charge -= 5;
                    updateRing(charge);
                    if (charge <= 0) {
                        clearInterval(rollback);
                        charge = 0;
                    }
                }, 10);
            }
        }

        function loop() {
            if (!isHolding) return;

            charge += 1; // è“„åŠ›é€Ÿåº¦
            updateRing(charge);
            AudioEngine.updateChargePitch(charge); // æ›´æ–°éŸ³æ•ˆé »ç‡

            // éœ‡å‹•ç‰¹æ•ˆ
            if (charge > 30) {
                core.classList.add('shake');
            }

            if (charge >= 100) {
                endHold();
            } else {
                animFrame = requestAnimationFrame(loop);
            }
        }

        function updateRing(percent) {
            const offset = totalLength - (percent / 100) * totalLength;
            ring.style.strokeDashoffset = offset;
        }

        function reveal() {
            isRevealed = true;
            instruction.style.opacity = 0;
            core.style.transform = "scale(0)"; // æ ¸å¿ƒç¸®å°æ¶ˆå¤±
            
            AudioEngine.playReveal(); // æ’­æ”¾æ­æ›‰éŸ³æ•ˆ (å®~)

            const finalAnswer = answers[Math.floor(Math.random() * answers.length)];
            answerEl.innerText = finalAnswer;
            answerEl.classList.add('show');

            // è‡ªå‹•é‡ç½®å¼•å° (æˆ–æ˜¯ç­‰å¾…ä½¿ç”¨è€…æŒ‰ Reset)
            setTimeout(() => {
                instruction.innerText = "é»æ“Šå·¦ä¸Šè§’é‡ç½®";
                instruction.style.opacity = 0.5;
            }, 2000);
        }

        // ç¶å®šäº‹ä»¶
        core.addEventListener('mousedown', startHold);
        core.addEventListener('touchstart', startHold, {passive: false});
        window.addEventListener('mouseup', endHold);
        window.addEventListener('touchend', endHold);

    </script>
</body>
</html>
